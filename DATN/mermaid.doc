erDiagram
    User ||--o{ Order : has
    User ||--o{ UserAddress : has
    User ||--|| Cart : has
    User ||--o{ ProductReview : writes
    User ||--o{ OrderReturn : requests
    User }o--o{ Role : has

    Role }o--o{ Permission : has

    Cart ||--o{ CartItem : contains

    Product ||--o{ ProductColor : has
    Product ||--o{ ProductReview : receives
    Product }o--o{ Promotion : has
    Product }o--|| Brand : belongs to
    Product }o--|| Category : belongs to
    Product }o--|| Supplier : supplied by

    ProductColor ||--o{ ProductVariant : has
    ProductColor ||--o{ ImageProduct : has
    ProductColor }o--|| Color : is

    ProductVariant ||--o{ Stock : has
    ProductVariant }o--|| Size : is
    ProductVariant ||--o{ CartItem : "is in"
    ProductVariant ||--o{ OrderItem : "is in"
    ProductVariant ||--o{ StockTransactionItem : "is in"

    Order ||--o{ OrderItem : contains
    Order ||--o{ OrderReturn : leads to
    Order ||--o{ Refund : can have
    Order }o--|| PaymentMethod : "uses"
    Order }o--|| UserAddress : "ships to"

    OrderItem ||--o{ OrderReturnItem : can be in
    OrderItem ||--|| ProductReview : can have

    OrderReturn ||--o{ OrderReturnItem : contains
    OrderReturn ||--o{ Refund : can result in

    Stock }o--|| WareHouse : located in
    Stock }o--|| Store : located in

    WareHouse ||--o{ StockTransaction : "from/to"
    Store ||--o{ StockTransaction : "from/to"
    Supplier ||--o{ StockTransaction : "from"

    StockTransaction ||--o{ StockTransactionItem : contains

    Brand {
        Long id PK
        String name
    }

    Category {
        Long id PK
        String name
    }

    Color {
        String code PK
        String name
        String hexCode
    }

    Size {
        String code PK
        Integer name
    }

    Supplier {
        UUID id PK
        String name
        String taxCode
        String email
    }

    User {
        Long id PK
        String username
        String email
        String password
    }

    Role {
        String name PK
        String description
    }

    Permission {
        String name PK
        String description
    }

    Cart {
        UUID id PK
        Long user_id FK
    }

    CartItem {
        UUID id PK
        UUID cart_id FK
        UUID product_variant_id FK
        Integer quantity
    }

    Product {
        UUID id PK
        String name
        String slug
        String productCode
        Long brand_id FK
        Long category_id FK
        UUID supplier_id FK
    }

    ProductColor {
        UUID id PK
        String color_code FK
        UUID product_id FK
    }

    ImageProduct {
        UUID id PK
        UUID product_color_id FK
        String imageUrl
    }

    ProductVariant {
        UUID id PK
        UUID product_color_id FK
        String size_code FK
        String sku
        BigDecimal price
    }

    Stock {
        UUID id PK
        UUID variant_id FK
        UUID warehouse_id FK
        UUID store_id FK
        Integer quantity
        StockType stockType
    }

    WareHouse {
        UUID id PK
        String name
        String location
    }

    Store {
        UUID id PK
        String name
        String location
    }

    StockTransaction {
        UUID id PK
        TransactionType type
        TransactionStatus status
        UUID supplier_id FK
        UUID from_warehouse_id FK
        UUID to_warehouse_id FK
        UUID from_store_id FK
        UUID to_store_id FK
    }

    StockTransactionItem {
        UUID id PK
        UUID transaction_id FK
        UUID variant_id FK
        Integer quantity
    }

    Order {
        UUID id PK
        String orderCode
        UUID user_id FK
        Long payment_method_id FK
        UUID user_address_id FK
        BigDecimal total_price
        OrderStatus orderStatus
    }

    OrderItem {
        UUID id PK
        UUID order_id FK
        UUID productVariant_id FK
        Integer quantity
        BigDecimal price
    }

    UserAddress {
        UUID id PK
        UUID user_id FK
        String receiverName
        String phoneNumber
        String streetDetail
    }

    ProductReview {
        UUID id PK
        UUID product_id FK
        Long user_id FK
        UUID order_item_id FK
        int rating
        String comment
    }

    Promotion {
        Long id PK
        String name
        PromotionType promotionType
        BigDecimal discountValue
    }

    PaymentMethod {
        Long id PK
        String displayName
    }

    OrderReturn {
        UUID id PK
        Long user_id FK
        UUID order_id FK
        String reasonReturn
        OrderReturnStatus status
    }

    OrderReturnItem {
        UUID id PK
        UUID order_return_id FK
        UUID order_item_id FK
        Integer quantity
    }

    Refund {
        UUID id PK
        UUID order_return_id FK
        UUID order_id FK
        BigDecimal amount
        RefundStatus status
    }

    Banner {
        UUID id PK
        String bannerName
        String imageUrl
        BannerType type
    }