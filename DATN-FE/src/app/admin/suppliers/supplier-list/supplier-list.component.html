<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Quản lý Nhà cung cấp</h2>
    <a routerLink="/admin/suppliers/create" class="btn btn-success">
      <i class="bi bi-plus-lg"></i> Thêm Nhà cung cấp
    </a>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="text-center">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p>Đang tải danh sách nhà cung cấp...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="alert alert-danger">
    {{ error }}
  </div>

  <!-- Suppliers Table -->
  <div *ngIf="!loading && !error" class="table-responsive">
    <table class="table table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th scope="col">Tên Nhà cung cấp</th>
          <th scope="col">Email</th>
          <th scope="col">Số điện thoại</th>
          <th scope="col">Địa chỉ</th>
          <th scope="col">Trạng thái</th>
          <th scope="col">Hành động</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let supplier of suppliers">
          <tr>
            <td><strong>{{ supplier.name }}</strong></td>
            <td>{{ supplier.email }}</td>
            <td>{{ supplier.phoneNumber }}</td>
            <td>{{ supplier.supplierAddress }}</td>
            <td>
              <span class="badge" [ngClass]="{'bg-success': supplier.status === 'ACTIVE', 'bg-warning': supplier.status === 'INACTIVE', 'bg-danger': supplier.status === 'SUSPENDED'}">
                {{ supplier.status }}
              </span>
            </td>
            <td>
              <button class="btn btn-sm btn-outline-primary me-2" (click)="toggleProductsForSupplier(supplier.id)">
                <i class="bi bi-box-seam"></i> {{ selectedSupplierIdForProducts === supplier.id ? 'Ẩn Sản phẩm' : 'Xem Sản phẩm' }}
              </button>
              <button class="btn btn-sm btn-outline-success me-2" (click)="importStock(supplier.id)">
                <i class="bi bi-box-arrow-in-down"></i> Nhập hàng
              </button>
              <button class="btn btn-sm btn-outline-warning me-2" disabled>
                <i class="bi bi-pencil"></i> Sửa
              </button>
              <button class="btn btn-sm btn-outline-danger" (click)="deleteSupplier(supplier.id)">
                <i class="bi bi-trash"></i> Xóa
              </button>
            </td>
          </tr>
          <!-- Products Sub-Table Row -->
          <tr *ngIf="selectedSupplierIdForProducts === supplier.id">
            <td colspan="6" class="p-0">
              <div class="p-3 bg-light">
                <h5>Sản phẩm của: {{ supplier.name }}</h5>
                <div *ngIf="loadingProducts" class="text-center">
                  <div class="spinner-border spinner-border-sm" role="status"></div>
                  <span> Đang tải sản phẩm...</span>
                </div>
                <div *ngIf="productsError" class="alert alert-warning">
                  {{ productsError }}
                </div>
                <div *ngIf="!loadingProducts && !productsError && productsForSelectedSupplier.length === 0">
                  <p class="text-muted">Không có sản phẩm nào cho nhà cung cấp này.</p>
                </div>
                <div *ngIf="productsForSelectedSupplier.length > 0" class="table-responsive">
                  <table class="table table-sm table-bordered bg-white">
                    <thead class="table-dark">
                      <tr>
                        <th scope="col">Mã Sản phẩm</th>
                        <th scope="col">Tên Sản phẩm</th>
                        <!-- <th scope="col">Hành động</th> -->
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let product of productsForSelectedSupplier">
                        <td>{{ product.productCode }}</td>
                        <td>{{ product.name }}</td>
                        <!-- <td>
                          <a [routerLink]="['/products', product.id, product.slug]" class="btn btn-sm btn-link">Chi tiết</a>
                        </td> -->
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>
</div>